<?php
    include 'connect.php';

?>

<!doctype html>
<html lang='en'>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Indoor Environment Quality</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <!-- Custom styles for this template-->
    <link href="css/style.css" rel="stylesheet">
</head>

<body id=page-top>
        
    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-icon rotate-n-15"></div>
                <div class="sidebar-brand-text mx-3">BMS<br> RSGM UMY</div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Nav Item - Lantai 1 -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseLt1"
                    aria-expanded="true" aria-controls="collapseLt1">
                    <span>Lantai 1</span>
                </a>
                <div id="collapseLt1" class="collapse" aria-labelledby="headingLt1" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="poli_gigi_1.html">Poli Gigi 1</a>
                        <a class="collapse-item" href="poli_gigi_2.html">Poli Gigi 2</a>
                        <a class="collapse-item" href="poli_gigi_3.html">Poli Gigi 3</a>
                        <a class="collapse-item" href="poli_gigi_4.html">Poli Gigi 4</a>
                        <a class="collapse-item" href="poli_gigi_anak.html">Poli Gigi Anak</a>
                        <a class="collapse-item" href="poli_pendidikan.html">Poli Pendidikan</a>
                        <a class="collapse-item" href="ruang_tunggu.html">Ruang Tunggu</a>
                        <a class="collapse-item" href="lobi.html">Lobi</a>
                        <a class="collapse-item" href="ruang_perawat_1.html">Ruang Perawat</a>
                        <a class="collapse-item" href="xray_1.html">Dental X-Ray 1</a>
                        <a class="collapse-item" href="xray_2.html">Dental X-Ray 2</a>
                        <a class="collapse-item" href="xray_3.html">Dental X-Ray 3</a>
                    </div>
                </div>
            </li>
            <!-- Divider -->
            <hr class="sidebar-divider">
            <!-- Nav Item - Lantai 2 -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseLt2"
                    aria-expanded="true" aria-controls="collapseLt2">
                    <span>Lantai 2</span>
                </a>
                <div id="collapseLt2" class="collapse" aria-labelledby="headingLt2"
                    data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="ruang_2A.html">Poli Pendidikan</A></a>
                        <a class="collapse-item" href="ruang_2B.html">Instalasi Rawat Inap 1</a>
                        <a class="collapse-item" href="ruang_2C.html">Ruang Operasi</a>
                        <a class="collapse-item" href="ruang_2D.html">Ruang Post-Operasi</a>
                        <a class="collapse-item" href="ruang_2D.html">Ruang Pre-Operasi</a>
                        <a class="collapse-item" href="ruang_2E.html">ICU</a>
                        <a class="collapse-item" href="ruang_2F.html">Ruang Manajemen</a>
                        <a class="collapse-item" href="ruang_2G.html">Ruang Direktur</a>
                        <a class="collapse-item" href="ruang_2H.html">Ruang Tunggu Keluarga</a>
                        <a class="collapse-item" href="ruang_2I.html">Nurse Station</a>
                        <a class="collapse-item" href="ruang_2J.html">Area Diskusi</a>
                    </div>
                </div>
            </li>
            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Nav Item - Lanta 3 -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseLt3"
                    aria-expanded="true" aria-controls="collapseLt3">
                    <span>Lantai 3</span>
                </a>
                <div id="collapseLt3" class="collapse" aria-labelledby="headingLt3"
                    data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="ruang_3A.html">Poli Pendidikan</a>
                        <a class="collapse-item" href="ruang_3B.html">Ruang OCSE</a>
                        <a class="collapse-item" href="ruang_3C.html">Ruang Dosen</a>
                        <a class="collapse-item" href="ruang_3D.html">Ruang Komite Medik</a>
                        <a class="collapse-item" href="ruang_3E.html">Ruang PDGI</a>
                        <a class="collapse-item" href="ruang_3F.html">Kantor Manajemen</a>
                    </div>
                </div>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Nav Item - Lantai 4 -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseLt4"
                    aria-expanded="true" aria-controls="collapseUtilities">
                    <span>Lantai 4</span>
                </a>
                <div id="collapseLt4" class="collapse" aria-labelledby="headingLt4"
                    data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="ruang_4A.html">Poli Pendidikan </a>
                        <a class="collapse-item" href="ruang_4B.html">Student Center</a>
                        <a class="collapse-item" href="ruang_4C.html">Aula</a>
                        <a class="collapse-item" href="ruang_4D.html">Mushola</a>
                    </div>
                </div>
            </li>
            <!-- Divider -->
            <hr class="sidebar-divider">
            <!-- Nav Item - Lantai 5 -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseLt5"
                    aria-expanded="true" aria-controls="collapseUtilities">
                    <span>Lantai 5</span>
                </a>
                <div id="collapseLt5" class="collapse" aria-labelledby="headingLt5"
                    data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <a class="collapse-item" href="ruang_5A.html">Kantor Manajemn</a>
                        <a class="collapse-item" href="ruang_5B.html">Kantor Komisaris</a>
                    </div>
                </div>
            </li>

            <!-- Sidebar Toggler (Sidebar) -->
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>

        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="energi.php" role="button">
                                <span>Energi</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="air.php" role="button">
                                <span>Air</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="site.php" role="button">
                                <span>Site Planning</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="ieq.php" role="button">
                                <span>IEQ</span>
                            </a>
                        </li>
                        <div class="topbar-divider d-none d-sm-block"></div>
                        <li class="nav-item">
                            <a class="nav-link" href="index.php" role="button">
                                <span>LogOut</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <!-- Begin Page Content -->
                <!-- queerying data -->
                <?php //prepping data//
                    //variabel status sessor temperatur
                    $status_sensor_temperatur = false;
                    $status_sensor_iluminansi = false;
                    $status_sensor_kelembapan = false;
                    $status_sensor_noise = false;
                    $status_sensor_co2 = false;
                    $status_sensor_pm2_5 = false;
                    $status_sensor_pm10 = false;
                    $status_sensor_co = false;
                    $status_sensor_voc = false;
                    $status_sensor_airpressure = false;
                    $status_sensor_ach = false;
                    $status_sensor_formaldehida=false;
                                    
                    // Query Realtime Data //
                    $query = $conn->query("SELECT 
                    DATE_TRUNC('second',waktu_db) AS waktu_db, 
                    ROUND(iluminansi,1) AS iluminansi, 
                    ROUND(temperatur,1) AS temperatur,
                    ROUND(kelembaban,1) AS kelembapan,
                    ROUND(co2, 0) AS co2,
                    ROUND(ach,0) AS vent_rate,
                    ROUND(voc, 3) AS voc,
                    ROUND(noise_audio,0) AS noise,
                    ROUND(pm2_5, 0) AS pm2_5,
                    ROUND(pm10, 3) AS pm10,
                    ROUND(airspeed, 2) AS airspeed
                    FROM rsgm.realtime_data 
                    WHERE ruangan_id = 1 
                    ORDER BY waktu_db DESC 
                    LIMIT 1");
                    if(!$query){
                        #echo "Error";
                        exit;
                    }else{
                        $rowdata = $query->fetch(PDO::FETCH_ASSOC);
                    }
                ?>
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <div class="d-xl-flex align-items-left mb-3">
                        <h1 class="h2 mb-2 text-gray-800"> Indoor Environment Quality Monitoring</h1>
                        <h3 class="h4 mb-2 text-gray-800">Lantai 1, Poli Gigi 1</h3>
                        <h5 class="h6 mb-2 text-blue-800">Last Update: <?php echo ($rowdata['waktu_db'])?></h5>
                    </div>

                    <!-- main content -->                 
                    <div class="row">
                        
                        <!-- column left -->
                        <div class= "col-xl-9 col-lg-6 col-md-5 mb-4">

                            <!--realtime data card -->
                            <div class="card shadow mb-4">
                                <!-- Header card -->
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Realtime Data</h6>
                                </div>
                                <!-- body card -->
                                <div class="card-body">
                                    <div class="grid grid-cols-5 my-5">
                                        <div class="text-center grid place-items-center col-span-5 lg:col-span-1 border-b-2 lg:border-none">
                                        <div class="">
                                            <p class="text-3xl lg:text-xl mb-3">IEQ Keseluruhan</p>
                                            <p class="text-5xl lg:text-3xl mb-5 lg:mb-0 text-green-500 font-bold">BAIK</p>
                                        </div>
                                        </div>
                                        <div class="col-span-5 text-3xl lg:text-base lg:col-span-4 mr-1">
                                        <div class="grid place-items-center grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 mb-5 space-y-5">
                                            <div class="text-center flex-row items-center">
                                                <p class="font-semibold">Temperature</p>
                                                <p class="text-green-500 font-bold"><?php 
                                                    if(empty($rowdata['temperatur'])){
                                                        echo "--";
                                                        $status_sensor_temperatur=false;
                                                    }else{
                                                        echo ($rowdata['temperatur']);
                                                        $status_sensor_temperatur=true;
                                                    }
                                                    ?>  <span>&#176;</span>C
                                                </p>
                                            </div>
                                            <div class="text-center flex-row items-center">
                                                <p class="font-semibold">Kelembaban</p>
                                                <p class="text-green-500 font-bold">
                                                    <?php 
                                                    if(empty($rowdata['temperatur'])){
                                                        echo "--";
                                                        $status_sensor_temperatur=false;
                                                    }else{
                                                        echo ($rowdata['temperatur']);
                                                        $status_sensor_temperatur=true;
                                                    }?> %
                                                </p>
                                            </div>
                                            <div class="text-center flex-row items-center">
                                                <p class="font-semibold">Laju Ventilasi</p>
                                                <p class="text-green-500 font-bold">
                                                    <?php
                                                    if(empty($rowdata['vent_rate'])){
                                                        echo "--";
                                                        $status_sensor_ach=false;
                                                    }else{
                                                        echo($rowdata['vent_rate']);
                                                        $status_sensor_ach=true;
                                                    }
                                                    ?>
                                                 dB</p>
                                            </div>
                                            <div class="text-center flex-row items-center">
                                                <p class="font-semibold">Kecepatan Udara</p>
                                                <p class="text-green-500 font-bold">
                                                    <?php 
                                                    if(empty($rowdata['airspeed'])){
                                                        echo"--";
                                                        $status_sensor_voc=false;
                                                    }else{
                                                        echo($rowdata['airspeed']);
                                                        $status_sensor_voc=true;
                                                    }
                                                    ?>
                                                    m/s</p>
                                            </div>
                                            <div class="text-center flex-row items-center">
                                                <p class="font-semibold">CO<sub>2</sub></p>
                                                <p class="text-green-500 font-bold"><?php echo $rowdata['vent_rate'];?> ach</p>
                                            </div>
                                            <div class="text-center flex-row items-center">
                                                <p class="font-semibold">CO</p>
                                                <p class="text-green-500 font-bold">0.05 ppm</p>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 mb-5 space-y-5">
                                            <div class="text-center flex-row items-center">
                                            <p class="font-semibold">PM 2.5</p>
                                            <p class="text-green-500 font-bold"><?php echo $rowdata['pm2_5'];?> mg/m<sup>3</sup></p>
                                            </div>
                                            <div class="text-center flex-row items-center">
                                            <p class="font-semibold">PM 10</p>
                                            <p class="text-green-500 font-bold"><?php echo $rowdata['pm10'];?> mg/m<sup>3</sup></p>
                                            </div>
                                            <div class="text-center flex-row items-center">
                                            <p class="font-semibold">CO<sub>2</sub></p>
                                            <p class="text-green-500 font-bold"><?php echo $rowdata['co2'];?> ppm</p>
                                            </div>
                                            <div class="text-center flex-row items-center">
                                            <p class="font-semibold">CO</p>
                                            <p class="text-green-500 font-bold">4.5 ppm</p>
                                            </div>
                                            <div class="text-center flex-row items-center">
                                            <p class="font-semibold">TVOC</p>
                                            <p class="text-green-500 font-bold"><?php echo $rowdata['voc'];?> ppb</p>
                                            </div>
                                            <div class="text-center flex-row items-center">
                                            <p class="font-semibold">Kecepatan udara</p>
                                            <p class="text-green-500 font-bold">m/s</p>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                    <table class = "realtime">
                                        <tr>
                                            <th>Temperatur</th>
                                            <th>Kelembapan</th>
                                            <th>Ventilation Rate</th>
                                            <th>VOC</th>
                                            <th>CO2</th>
                                            <th>CO</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <?php 
                                                
                                                ?> 
                                                degree
                                            </td>
                                            <td>
                                                <?php
                                                if(empty($rowdata['kelembapan'])){
                                                    echo "--";
                                                    $status_sensor_kelembapan=false;
                                                }else{
                                                    echo ($rowdata['kelembapan']);
                                                    $status_sensor_kelembapan=true;
                                                }
                                                ?>
                                                %
                                            </td>
                                            <td>
                                                <?php
                                                if(empty($rowdata['vent_rate'])){
                                                    echo "--";
                                                    $status_sensor_ach=false;
                                                }else{
                                                    echo($rowdata['vent_rate']);
                                                    $status_sensor_ach=true;
                                                }
                                                ?>
                                                ACH
                                            </td>
                                            <td>
                                                <?php
                                                if(empty($rowdata['voc'])){
                                                    echo"--";
                                                    $status_sensor_voc=false;
                                                }else{
                                                    echo($rowdata['voc']);
                                                    $status_sensor_voc=true;
                                                }
                                                ?>
                                                ppm 
                                            </td>
                                            <td>
                                                <?php
                                                if(empty($rowdata['co2'])){
                                                    echo"--";
                                                    $status_sensor_co2=false;
                                                }else{
                                                    echo($rowdata['co2']);
                                                    $status_sensor_co2=true;
                                                }
                                                ?> 
                                                ppm
                                            </td>
                                            <td>
                                                E ppm
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>PM 2.5</th>
                                            <th>PM 10</th>            
                                            <th>Iluminansi</th>
                                            <th>Noise</th>
                                            <th>Formaldehida</th>
                                            <th>Air Pressure</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <?php
                                                if(empty($rowdata['2_5'])){
                                                    echo "E";
                                                    $status_sensor_pm2_5=false;
                                                }
                                                else{
                                                    echo($rowdata['pm2_5']);
                                                    $status_sensor_pm2_5=true;
                                                }
                                                ?>
                                                ppm
                                            </td>
                                            <td>
                                                <?php
                                                if(empty($rowdata['pm10'])){
                                                    echo "E";
                                                    $status_sensor_pm10=false;
                                                }
                                                else{
                                                    echo ($rowdata['pm10']);
                                                    $status_sensor_pm10=true;
                                                }
                                                ?>
                                                ppm
                                            </td>
                                            <td>
                                                <?php
                                                if(empty($rowdata['iluminansi'])){
                                                    echo "E";
                                                    $status_sensor_iluminansi = false;
                                                }else{
                                                    echo ($rowdata['iluminansi']);
                                                    $status_sensor_iluminansi = true;
                                                    }
                                                ?>
                                                lux
                                            </td>
                                            <td>
                                                <?php
                                                if(empty($rowdata['noise'])){
                                                    echo"E";
                                                    $status_sensor_noise=false;
                                                }else{
                                                    echo ($rowdata['noise']);
                                                    $status_sensor_noise=true;
                                                }                                            
                                                ?>
                                                db
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>      
                            <!-- Line graph -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Area Chart</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas id="myAreaChart"></canvas>
                                    </div>
                                    <hr>
                                    Styling for the area chart can be found in the
                                    <code>/js/demo/chart-area-demo.js</code> file.
                                </div>
                            </div>
                        </div>
                        <!--column right-->
                        <div class="col-xl-3 col-lg-4 col-md-5 mb-4">
                            <!-- status sensor -->    
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Status Sensor</h6>
                                </div>
                                <div class="card-body">
                                    <table class="table-sensor">
                                        <tr>
                                            <th>Sensor Temperatur</th>
                                            <td>
                                                <?php
                                                if($status_sensor_temperatur==false){
                                                    echo ("OFF");
                                                }else{
                                                    echo("ON");
                                                }
                                                ?>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Sensor Kelembapan</th>
                                            <td>
                                                <?php
                                                if($status_sensor_kelembapan==false){
                                                    echo("OFF");
                                                }else{
                                                    echo("ON");
                                                }
                                                ?>
                                            </td>                
                                        </tr>
                                        <tr>
                                            <th>Sensor Cahaya</th>
                                            <td>
                                                <?php
                                                if($status_sensor_iluminansi==false){
                                                    echo("OFF");
                                                }else{
                                                    echo("ON");
                                                }
                                                ?>
                                            </td>                
                                        </tr>
                                        <tr>
                                            <th>Sensor Audio</th>
                                            <td>
                                                <?php
                                                if($status_sensor_noise==false){
                                                    echo("OFF");
                                                }else{
                                                    echo("ON");
                                                }
                                                ?>
                                            </td>                
                                        </tr>
                                        <tr>
                                            <th>Sensor CO2</th>
                                            <td>
                                                <?php
                                                if($status_sensor_co2==false){
                                                    echo("OFF");
                                                }else{
                                                    echo("ON");
                                                }
                                                ?>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Sensor CO</th>
                                                <td>
                                                <?php
                                                if($status_sensor_co==false){
                                                    echo("OFF");
                                                }else{
                                                    echo("ON");
                                                }
                                                ?>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Sensor Formaldehida</th>
                                            <td>
                                                <?php
                                                if($status_sensor_formaldehida==false){
                                                    echo("OFF");
                                                }else{
                                                    echo("ON");
                                                }
                                                ?>
                                            </td>
                                        </tr>
                                        <tr>    
                                            <th>Sensor PM 2.5 </th>
                                            <td>
                                                <?php
                                                if($status_sensor_pm2_5==false){
                                                    echo("OFF");
                                                }else{
                                                    echo("ON");
                                                }
                                                ?>
                                            </td>
                                        </tr>
                                        <tr>    
                                            <th>Sensor PM 10 </th>
                                            <td>
                                                <?php
                                                if($status_sensor_pm10==false){
                                                    echo("OFF");
                                                }else{
                                                    echo("ON");
                                                }
                                                ?>
                                                </td>
                                        </tr>
                                        <tr>
                                            <th>Sensor VOC</th>
                                            <td>
                                                <?php
                                                if($status_sensor_voc==false){
                                                    echo("OFF");
                                                }else{
                                                    echo("ON");
                                                }
                                                ?>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Sensor Ventilation Rate</th>
                                            <td>
                                                <?php
                                                if($status_sensor_ach==false){
                                                    echo("OFF");
                                                }else{
                                                    echo("ON");
                                                }
                                                ?>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Sensor Air Pressure</th>
                                            <td>
                                                <?php
                                                if($status_sensor_airpressure==true){
                                                    echo("ON");
                                                }else{
                                                    echo("OFF");
                                                }
                                                ?>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- comfort meter -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m0 font-weight-bold text-primary">Hasil POE</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Parameter:</div>
                                            <a class="dropdown-item" href="#">Termal</a>
                                            <a class="dropdown-item" href="#">Cahaya</a>
                                            <a class="dropdown-item" href="#">Noise</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Download Data</a>
                                        </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-pie pt-4">
                                            <canvas id="myPieChart"></canvas>
                                        </div>
                                        <hr>Isinya hasil persenan orang yang 
                                        udh ngisi survey yeay
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                            
                    <!-- Footer -->
                    <footer class="sticky-footer bg-white">
                        <div class="container my-auto">
                            <div class="copyright text-center my-auto">
                                <span>Copyright &copy; Your Website 2021</span>
                            </div>

                        </div>
                    </footer>
                    <!-- End of Footer -->
                </div>
            </div>
        </div>

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="vendor/chart.js/Chart.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="js/demo/chart-area-demo.js"></script>
    <script src="js/demo/chart-pie-demo.js"></script>
    <script src="js/demo/chart-bar-demo.js"></script>
    </body>
 <!-- history section -->
<!--                     
        <?php
        $tgf = [];
        $waktu = [];
        $igf = [];
        $hgf = [];
        $achgf = [];
        $nagf = [];
        $airgf = [];
        $querygrafik_menit = $conn->query(
            "SELECT TO_CHAR(waktu_db, 'HH24:MI:SS') AS waktu, 
            ROUND(iluminansi, 1) AS iluminansi, 
            ROUND(temperatur, 1) AS temperatur,
            ROUND(kelembaban, 1) AS kelembapan,
            ROUND(ach,0) AS vent_rate,
            ROUND(noise_audio,0) AS noise,
            ROUND(airspeed, 0) AS airspeed
            FROM rsgm.realtime_data 
            WHERE ruangan_id=1 AND DATE_TRUNC('minute', waktu_db) >= NOW() - interval '15 minutes'
            ORDER BY waktu DESC");
        while($rowc = $querygrafik_menit->fetch()){
            $tgf[] = $rowc['temperatur'];
            $igf[] = $rowc['iluminansi'];
            $hgf[] = $rowc['kelembapan'];
            $achgf[] = $rowc['ach'];
            $nagf[] = $rowc['noise'];
            $airgf [] = $airgf['airspeed'];
            $waktu[] = $rowc['waktu'];
        }
        
        $querygrafik_harian= $conn->query(
        "SELECT TO_CHAR(DATE_TRUNC('hour', waktu_db), 'HH24:MI') AS waktu_jam, 
        ROUND(AVG(voc), 2) as tvoc, 
        ROUND(AVG(pm2_5),2) as pm2_5,
        ROUND(AVG(pm10), 2) as pm10,
        ROUND(AVG(co2), 2) as co2,
        ROUND(AVG(co), 2) as co
        FROM rsgm.realtime_data
        WHERE ruangan_id=1 AND DATE_TRUNC('day', waktu_db) >= NOW() - interval '1 day'
        GROUP BY DATE waktu_jam
        ORDER BY waktu_db DESC 
        ");
        $waktu_jam=[];
        $co2gf = [];
        $tvocgf = [];
        $pm25gf = [];
        $pm10gf = [];
        $cogf = [];
        while ($rowc = $querygrafik_harian->fetch()){
            $co2gf[] = $rowc['co2'];
            $cogf[] = $rowc['co'];
            $vocgf[] = $rowc['voc'];
            $pm25gf[] = $rowc['pm2_5'];
            $pm10gf[] = $rowc['pm10'];
            $waktu_jam[] = $rowc['waktu_jam'];
        }
        ?>
-->                        
<?php
$kenyamanan_termal=[];
$kenyamanan_visual=[];
$kenyamanan_akustik=[];
$sensasi_termal=[];
$total=[];
$kt_sangatbaik = 0;


$query_total_responden = $conn->query('SELECT COUNT(survey_id) AS total FROM rsgm.hasil_survey WHERE ruangan_id = 1' );
$total_responden = $query_total_responden->fetch(PDO::FETCH_ASSOC);
echo $total_responden['total'];

$query_poe = $conn->query('SELECT COUNT(survey_id) AS total, kenyamanan_termal, kenyamanan_visual, kenyamanan_akustik, sensasi_termal 
FROM rsgm.hasil_survey
WHERE ruangan_id=1');

while ($rows = $query_poe->fetch()) {
    array_push($kenyamanan_termal, $rows['kenyamanan_termal']); // Adding to array
    array_push($kenyamanan_visual, $rows['kenyamanan_visual']);
    array_push($kenyamanan_akustik, $rows['kenyamanan_akustik']);
    array_push($sensasi_termal, $rows['sensasi_termal']);
}

$data_ka = (array_count_values($kenyamanan_akustik));
$data_st = (array_count_values($sensasi_termal));

#data kenyamanan termal
$data_kt = (array_count_values($kenyamanan_termal));
if (array_key_exists('sangat baik', $data_kt)){
    $kt_sangatbaik = [$data_kt['sangat baik']];
}else {
    $kt_sangatbaik=0;
}
if(array_key_exists('baik', $data_kt)){
    $kt_baik = [$data_kt['baik']];
}
else {$kt_baik = 0;
}
if(array_key_exists('cukup', $data_kt)){
    $kt_cukup = ($data_kt['cukup']);
}else {$kt_cukup = 0;
}
if(array_key_exists('buruk', $data_kt)){
    $kt_buruk = ($data_kt['buruk']);
}else {$kt_sangatburuk=0;
}
if(array_key_exists('sangat buruk', $data_kt)){
    $kt_sangatburuk = ($data_kt['sangat buruk']);}
else {$kt_sangatburuk=0;
}

#data kenyamanan visual
$data_kv = (array_count_values($kenyamanan_visual));
if (array_key_exists('sangat baik', $data_kv)){
    $kv_sangatbaik = intval($data_kv['sangat baik']);
}else {
    $kv_sangatbaik=0;
}
if(array_key_exists('baik', $data_kv)){
    $kv_baik = intval($data_kv['baik']);
}
else {$kv_baik = 0;
}
if(array_key_exists('cukup', $data_kv)){
    $kv_cukup = intval($data_kv['cukup']);
}else {$kv_cukup = 0;
}
if(array_key_exists('buruk', $data_kv)){
    $kv_buruk = intval($data_kv['buruk']);
}else {$kv_sangatburuk=0;
}
if(array_key_exists('sangat buruk', $data_kv)){
    $kv_sangatburuk = intval($data_kv['sangat buruk']);}
else {$kv_sangatburuk=0;
}

#data kenyamanan akustik
$data_ka = (array_count_values($kenyamanan_akustik));
if (array_key_exists('sangat baik', $data_ka)){
    $ka_sangatbaik = intval($data_ka['sangat baik']);
}else {
    $ka_sangatbaik=0;
}
if(array_key_exists('baik', $data_ka)){
    $ka_baik = intval($data_ka['baik']);
}
else {$ka_baik = 0;
}
if(array_key_exists('cukup', $data_ka)){
    $ka_cukup = intval($data_ka['cukup']);
}else {$ka_cukup = 0;
}
if(array_key_exists('buruk', $data_ka)){
    $ka_buruk = intval($data_ka['buruk']);
}else {$ka_sangatburuk=0;
}
if(array_key_exists('sangat buruk', $data_ka)){
    $ka_sangatburuk = intval($data_ka['sangat buruk']);}
else {$ka_sangatburuk=0;
}
?>




<script>
    var kt_sangatbaik = <?php echo json_encode($kt_sangatbaik);?>;
    var kt_baik = <?php echo json_encode($kt_sangatbaik);?>;
    var kt_cukup = <?php echo json_encode($kt_cukup);?>;
    var kt_buruk = <?php echo json_encode($kt_buruk);?>;
    var kt_sangatburuk = <?php echo json_encode($kt_sangatburuk);?>;

    var kv_sangatbaik = <?php echo json_encode($kt_sangatbaik);?>;
    var kv_baik = <?php echo json_encode($kt_sangatbaik);?>;
    var kv_cukup = <?php echo json_encode($kt_cukup);?>;
    var kv_buruk = <?php echo json_encode($kt_buruk);?>;
    var kv_sangatburuk = <?php echo json_encode($kt_sangatburuk);?>;

    var ka_sangatbaik = <?php echo json_encode($kt_sangatbaik);?>;
    var ka_baik = <?php echo json_encode($kt_sangatbaik);?>;
    var ka_cukup = <?php echo json_encode($kt_cukup);?>;
    var ka_buruk = <?php echo json_encode($kt_buruk);?>;
    var ka_sangatburuk = <?php echo json_encode($kt_sangatburuk);?>;

    var kenyamanan_visual = <?php echo json_encode($kenyamanan_visual);?>;
    var kenyamanan_visual = kenyamanan_visual.reverse();
    var kenyamanan_akustik = <?php echo json_encode($kenyamanan_visual);?>;
    var kenyamanan_akustik = kenyamanan_akustik.reverse();
    var sensasi_termal = <?php echo json_encode($sensasi_termal);?>;
    var sensasi_termal = sensasi_termal.reverse();

</script>


        <!-- Bootstrap core JavaScript-->
        <script src="vendor/jquery/jquery.min.js"></script>
        <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

        <!-- Core plugin JavaScript-->
        <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

        <!-- Custom scripts for all pages-->
        <script src="js/sb-admin-2.min.js"></script>

        <!-- Page level plugins -->
        <script src="vendor/chart.js/Chart.min.js"></script>

        <!-- Page level custom scripts -->
        <script src="js/demo/chart-area-demo.js"></script>
        <script src="js/demo/chart-pie-demo.js"></script>
</html>
